(function(){var EventEmitter,t,Stor,e=[].slice,s={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};EventEmitter=function(){function EventEmitter(){this._callbacks={}}return EventEmitter.prototype.on=function(t,e){var s;return((s=this._callbacks)[t]||(s[t]=[])).push(e),this},EventEmitter.prototype.once=function(t,e){var s,n=this;return s=function(){return n.off(t,s),e.apply(n,arguments)},e._off=s,this.on(t,s)},EventEmitter.prototype.off=function(t,e){var s,n;return(s=this._callbacks[t])?1===arguments.length?(delete this._callbacks[t],this):(n=s.indexOf(e._off||e),~n&&s.splice(n,1),this):this},EventEmitter.prototype.emit=function(){var t,s,n,o,r,i,a;if(o=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],n=this._callbacks[o])for(a=n.slice(0),r=0,i=a.length;i>r;r++)s=a[r],s.apply(this,t);return this},EventEmitter.prototype.listeners=function(t){return this._callbacks[t]||[]},EventEmitter.prototype.hasListeners=function(t){return!!this.listeners(t).length},EventEmitter}(),jQuery(function($){var OptionsDrawer;return OptionsDrawer=function(t){function OptionsDrawer(t){var e;OptionsDrawer.__super__.constructor.call(this),e={selectors:{optsDrawer:"#optionsDrawer",toggleBtns:".toggleBtn",toggleChks:".toggleChk",optsForm:"form#optionsDrawerWrap",optsBtn:"#optionsButton",optsLnk:"#optionsLink",nav:"#nav"},fx:{duration:500},text:{optsOpen:"Close",optsDefault:"Options"}},this.opts=$.extend(e,t),this.isOpen=!1,this.setupEls(),this.closeDrawer(!0),this.setupEvents(),this.updateModel()}return n(OptionsDrawer,t),OptionsDrawer.prototype.setupEls=function(){var t,e,s,n;t={},this.els={},n=this.opts.selectors;for(e in n)s=n[e],/^\.\w/i.test(s)?t[e]=s:this.els[e]=$(s);for(e in t)s=t[e],this.els[e]=this.els.optsDrawer.find(s);this.els.optsDrawer.find(".hide").hide().removeClass("hide")},OptionsDrawer.prototype.setupEvents=function(){var t,e;e=this,t=e.els,t.optsBtn.on("click",function(t){return t.preventDefault(),e.isOpen?e.closeDrawer.call(e):e.openDrawer.call(e,t)}),t.optsLnk.on("click",function(t){return t.preventDefault(),e.els.optsBtn.trigger("click")}),t.optsForm.on("change",function(t){return e.updateModel.call(e,t)}),t.optsForm.on("submit",function(t){return t.preventDefault()})},OptionsDrawer.prototype.updateModel=function(t){var e,s,n;return null==t&&(t={}),s=this.model||{},n=this.els.optsForm.serialize(),e=function(){var t,s,o,r,i;for(e={},s=n.split("&"),r=0,i=s.length;i>r;r++)t=s[r],o=t.split("="),e[o[0]]=o[1]||"";return e}(),this.emit("change",t,e,s),this.model=e},OptionsDrawer.prototype.openDrawer=function(){var t,e;e={top:this.els.nav.height(),opacity:1},t={duration:this.opts.fx.duration},this.detach(),this.animateDrawer("open",e,t)},OptionsDrawer.prototype.closeDrawer=function(t){var e,s,n;n=this,s={top:-this.getDrawerTop(),opacity:0},e={duration:t?0:this.opts.fx.duration},e.complete=t?function(){return n.els.optsDrawer.fadeIn()}:void 0,this.animateDrawer("close",s,e)},OptionsDrawer.prototype.animateDrawer=function(t,e,s){var n,o,r,i;i=this,r=this.els.optsDrawer,o=new $.Deferred,n=s.complete||function(){},s.complete=function(){return o.resolve(),n.apply(i,arguments)},r.animate(e,s),o.done(function(){return"close"===t?i.onClose.call(i):i.onOpen.call(i)})},OptionsDrawer.prototype.onOpen=function(){this.isOpen=!0},OptionsDrawer.prototype.onClose=function(){this.attach(),this.isOpen=!1},OptionsDrawer.prototype.getDrawerTop=function(){return this.els.optsDrawer.outerHeight()-this.els.nav.height()},OptionsDrawer.prototype.getBtnLeft=function(){var t;return t=this.els.optsBtn[0],t.parentElement.offsetLeft+t.parentElement.parentElement.offsetLeft},OptionsDrawer.prototype.attach=function(){this.els.optsBtn.insertAfter(this.els.optsLnk),this.els.optsBtn.removeClass("active")[0].style.cssText=""},OptionsDrawer.prototype.detach=function(){var t,e,s,n;t=this.els,s=t.optsBtn,n=s.width(),e=this.getBtnLeft(),t.optsBtn.css({left:e,width:n}).addClass("active"),this.els.optsBtn.appendTo(this.els.optsForm)},OptionsDrawer}(EventEmitter),$.fn.OptionsDrawer=OptionsDrawer}),Stor=function(){function Stor(t,e){this.key=null!=t?t:void 0,this.exp=null!=e?e:null,this.amp=amplify.store}return Stor.prototype.get=function(t){return null==t&&(t=this.key),this.amp(t)},Stor.prototype.set=function(t,e,s){return null==e&&(e=this.key),null==s&&(s=this.exp),this.amp(e,t,s)},Stor.prototype.remove=function(t){return null==t&&(t=this.key),this.amp(t,null)},Stor.prototype.empty=function(){var t,e;return t=this,e=t.amp(),$.each(e,function(e,s){t.amp(s,null)})},Stor}(),t=function(){function t(t,e){var s;t&&(this.elements=t,this.editor=CodeMirror.fromTextArea(t.lessInput[0],{theme:"lesser-dark",lineNumbers:!0,matchBrackets:!0,tabSize:2}),s={cdnFallback:"js/less/less-{version}.js",useFallback:!1,saveLess:!0,lessCDN:"//raw.github.com/cloudhead/less.js/master/dist/less-{version}.js",lessOptions:{dumpLineNumbers:!1,relativeUrls:!1,rootpath:!1}},this.options=$.extend(s,e),this.storage=new Stor("lessCode"),this.setupDrawer())}return t.prototype.updateOptions=function(){var t;return t=this.options.lessOptions},t.prototype.setupDrawer=function(){var t,e;return t=new $.fn.OptionsDrawer,e=t.els,e.toggleBtns.on("click",function(){var t,s,n,o;o=e.toggleBtns.index(this),n=e.toggleChks.eq(o),t=$(this),n.trigger("click"),s=n.is(":checked"),s?t.addClass("btn-primary").text("Enabled").siblings(":disabled").addClass("enabled").fadeIn().attr("disabled",!1).trigger("change"):t.removeClass("btn-primary").text("Disabled").siblings(".enabled").fadeOut().attr("disabled",!0).trigger("change")}),this.drawer=t,this},t.prototype.setupEvents=function(){var t,e,s,n,o;return n=this,s=this.elements,e=this.editor,t=this.storage.get(),o=s.lessVersion.find("option"),t?(e.setValue(t),this.previousLessCode=t):this.previousLessCode=e.getValue(),this.drawer.on("change",function(t,e){var s,o,r;return s=$(t.target),o=s.attr("name"),"lessVersion"===o?(r=s.find("option").filter(":selected").is("[data-prerelease=true]")?!0:!1,n.loadLess(r)):(n.updateOptions(e),n.loadLess()),console.log(e)}),e.on("change",function(){var t;t=n.editor.getValue(),n.previousLessCode!==t&&(n.previousLessCode=t,n.compileLess())}),this},t.prototype.loadLess=function(t){var e,s,n,o,r,i,a;return i=this,n=this.options,e=this.elements,o=n.useFallback?n.cdnFallback:n.lessCDN,e.loadingGif.fadeIn(),this.editor.options.readOnly=!0,a=e.lessVersion.val(),a=t?""+a+"-alpha":a,r=o.replace("{version}",a),window.less=void 0,s=$.ajax({dataType:"script",cache:!0,url:r}),s.then(function(){window.less?i.loadComplete.call(i):(i.tryCount=i.tryCount?i.tryCount++:1,i.options.useFallback=!0,3>=i.tryCount&&i.loadLess())}),this},t.prototype.loadComplete=function(){return this.parser=new less.Parser(this.options.lessOptions),this.editor.options.readOnly=!1,this.compileLess(),this.elements.loadingGif.fadeOut(),this},t.prototype.compileLess=function(){var t,e;e=this.editor.getValue(),this.options.saveLess&&this.storage.set(e);try{t=this.parseLess(e),this.updateCSS(t)}catch(s){this.updateError(s)}return this},t.prototype.updateCSS=function(t){var e;return e=hljs.highlight("css",t).value,this.elements.cssCode.css("color","").html(e),this},t.prototype.updateError=function(t){var e;return e=""+t.type+" error: "+t.message+"\n"+(t.extract&&t.extract.join&&t.extract.join("")),this.elements.cssCode.css("color","red").text(e),this},t.prototype.parseLess=function(t){var e;return e="",this.parser.parse(t,function(t,s){if(t)throw t;return e=s.toCSS()}),e},t}(),jQuery(function($){var e,s;return s={lessVersion:$("#lessVersion"),loadingGif:$("#loadingGif"),lessInput:$("#lessInput"),cssCode:$("#cssOutput")},e=window.comp=new t(s),e.setupEvents().loadLess()})}).call(this);