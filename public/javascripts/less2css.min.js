var EventEmitter,__slice=[].slice;EventEmitter=function(){function EventEmitter(){this._callbacks={}}return EventEmitter.prototype.on=function(event,fn){var _base;return((_base=this._callbacks)[event]||(_base[event]=[])).push(fn),this},EventEmitter.prototype.once=function(event,fn){var once,_this=this;return once=function(){return _this.off(event,once),fn.apply(_this,arguments)},fn._off=once,this.on(event,once)},EventEmitter.prototype.off=function(event,fn){var callbacks,i;return(callbacks=this._callbacks[event])?1===arguments.length?(delete this._callbacks[event],this):(i=callbacks.indexOf(fn._off||fn),~i&&callbacks.splice(i,1),this):this},EventEmitter.prototype.emit=function(){var args,callback,callbacks,event,_i,_len,_ref;if(event=arguments[0],args=arguments.length>=2?__slice.call(arguments,1):[],callbacks=this._callbacks[event])for(_ref=callbacks.slice(0),_i=0,_len=_ref.length;_len>_i;_i++)callback=_ref[_i],callback.apply(this,args);return this},EventEmitter.prototype.listeners=function(event){return this._callbacks[event]||[]},EventEmitter.prototype.hasListeners=function(event){return!!this.listeners(event).length},EventEmitter}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};jQuery(function($){var OptionsDrawer;return OptionsDrawer=function(_super){function OptionsDrawer(options){var defaults;defaults={selectors:{optsDrawer:"#optionsDrawer",toggleBtns:".toggleBtn",toggleChks:".toggleChk",optsForm:"form#optionsDrawerWrap",optsBtn:"#optionsButton",optsLnk:"#optionsLink",nav:"#nav"},fx:{duration:500},text:{optsOpen:"Close",optsDefault:"Options"}},this.opts=$.extend(defaults,options),this.isOpen=!1,this.setupEls(),this.closeDrawer(!0),this.setupEvents(),this.updateModel()}return __extends(OptionsDrawer,_super),OptionsDrawer.prototype.setupEls=function(){var classes,name,selector,_ref;classes={},this.els={},_ref=this.opts.selectors;for(name in _ref)selector=_ref[name],/^\.\w/i.test(selector)?classes[name]=selector:this.els[name]=$(selector);for(name in classes)selector=classes[name],this.els[name]=this.els.optsDrawer.find(selector)},OptionsDrawer.prototype.setupEvents=function(){var els,self;self=this,els=self.els,self.setupEmitter(),els.optsBtn.on("click",function(e){return e.preventDefault(),self.isOpen?self.closeDrawer.call(self):self.openDrawer.call(self,e)}),els.optsLnk.on("click",function(e){return e.preventDefault(),self.els.optsBtn.trigger("click")}),els.optsForm.on("change",function(){return self.updateModel.call(self)}),els.optsForm.on("submit",function(e){return e.preventDefault()})},OptionsDrawer.prototype.setupEmitter=function(){return this.evts={}},OptionsDrawer.prototype.updateModel=function(){var curr,prev,values;return prev=this.model||{},values=this.els.optsForm.serialize(),curr=function(){var field,fields,split,_i,_len;for(curr={},fields=values.split("&"),_i=0,_len=fields.length;_len>_i;_i++)field=fields[_i],split=field.split("="),curr[split[0]]=split[1]||"";return curr}(),this.model=curr},OptionsDrawer.prototype.openDrawer=function(){var opts,props;props={top:this.els.nav.height(),opacity:1},opts={duration:this.opts.fx.duration},this.detach(),this.animateDrawer("open",props,opts)},OptionsDrawer.prototype.closeDrawer=function(start){var opts,props,self;self=this,props={top:-this.getDrawerTop(),opacity:0},opts={duration:start?0:this.opts.fx.duration},opts.complete=start?function(){return self.els.optsDrawer.fadeIn()}:void 0,this.animateDrawer("close",props,opts)},OptionsDrawer.prototype.animateDrawer=function(action,props,opts){var cb,defer,optsDrawer,self;self=this,optsDrawer=this.els.optsDrawer,defer=new $.Deferred,cb=opts.complete||function(){},opts.complete=function(){return defer.resolve(),cb.apply(self,arguments)},optsDrawer.animate(props,opts),defer.done(function(){return"close"===action?self.onClose.call(self):self.onOpen.call(self)})},OptionsDrawer.prototype.onOpen=function(){this.isOpen=!0},OptionsDrawer.prototype.onClose=function(){this.attach(),this.isOpen=!1},OptionsDrawer.prototype.getDrawerTop=function(){return this.els.optsDrawer.outerHeight()-this.els.nav.height()},OptionsDrawer.prototype.getBtnLeft=function(){var btn;return btn=this.els.optsBtn[0],btn.parentElement.offsetLeft+btn.parentElement.parentElement.offsetLeft},OptionsDrawer.prototype.attach=function(){this.els.optsBtn.insertAfter(this.els.optsLnk),this.els.optsBtn.removeClass("active")[0].style.cssText=""},OptionsDrawer.prototype.detach=function(){var els,left,optsBtn,wid;els=this.els,optsBtn=els.optsBtn,wid=optsBtn.width(),left=this.getBtnLeft(),els.optsBtn.css({left:left,width:wid}).addClass("active"),this.els.optsBtn.appendTo(this.els.optsForm)},OptionsDrawer}(EventEmitter),$.fn.OptionsDrawer=OptionsDrawer});var LessCompiler,Stor;Stor=function(){function Stor(key,exp){this.key=null!=key?key:void 0,this.exp=null!=exp?exp:null,this.amp=amplify.store}return Stor.prototype.get=function(key){return null==key&&(key=this.key),this.amp(key)},Stor.prototype.set=function(val,key,exp){return null==key&&(key=this.key),null==exp&&(exp=this.exp),this.amp(key,val,exp)},Stor.prototype.remove=function(key){return null==key&&(key=this.key),this.amp(key,null)},Stor.prototype.empty=function(){var self,storage;return self=this,storage=self.amp(),$.each(storage,function(itm,key){self.amp(key,null)})},Stor}(),LessCompiler=function(){function LessCompiler(elements,options){var defaults;elements&&(this.elements=elements,this.editor=CodeMirror.fromTextArea(elements.lessInput[0],{theme:"lesser-dark",lineNumbers:!0,matchBrackets:!0,tabSize:2}),defaults={cdnFallback:"js/less/less-{version}.js",useFallback:!1,saveLess:!0,lessCDN:"//raw.github.com/cloudhead/less.js/master/dist/less-{version}.js"},this.drawer=new $.fn.OptionsDrawer,this.options=$.extend(defaults,options),this.storage=new Stor("lessCode"))}return LessCompiler.prototype.setupEvents=function(){var cachedLess,editor,els,self,versionOpts;return self=this,els=this.elements,editor=this.editor,cachedLess=this.storage.get(),versionOpts=els.lessVersion.find("option"),cachedLess?(editor.setValue(cachedLess),this.previousLessCode=cachedLess):this.previousLessCode=editor.getValue(),els.lessVersion.on("change",function(){var preRelease;return preRelease=versionOpts.filter(":selected").is("[data-prerelease=true]")?!0:!1,self.loadLess(preRelease)}),editor.on("change",function(){var lessCode;lessCode=self.editor.getValue(),self.previousLessCode!==lessCode&&(self.previousLessCode=lessCode,self.compileLess())}),this},LessCompiler.prototype.loadLess=function(preRelease){var els,getScript,opts,path,scriptUrl,self,version;return self=this,opts=this.options,els=this.elements,path=opts.useFallback?opts.cdnFallback:opts.lessCDN,els.loadingGif.fadeIn(),this.editor.options.readOnly=!0,version=els.lessVersion.val(),version=preRelease?""+version+"-alpha":version,scriptUrl=path.replace("{version}",version),window.less=void 0,getScript=$.ajax({dataType:"script",cache:!0,url:scriptUrl}),getScript.then(function(){window.less?self.loadComplete.call(self):(self.tryCount=self.tryCount?self.tryCount++:1,self.options.useFallback=!0,3>=self.tryCount&&self.loadLess())}),this},LessCompiler.prototype.loadComplete=function(){return this.parser=new less.Parser({}),this.editor.options.readOnly=!1,this.compileLess(),this.elements.loadingGif.fadeOut(),this},LessCompiler.prototype.compileLess=function(){var compiledCSS,lessCode;lessCode=this.editor.getValue(),this.options.saveLess&&this.storage.set(lessCode);try{compiledCSS=this.parseLess(lessCode),this.updateCSS(compiledCSS)}catch(lessEx){this.updateError(lessEx)}return this},LessCompiler.prototype.updateCSS=function(compiledCSS){var highlightedCSS;return highlightedCSS=hljs.highlight("css",compiledCSS).value,this.elements.cssCode.css("color","").html(highlightedCSS),this},LessCompiler.prototype.updateError=function(lessEx){var errorText;return errorText=""+lessEx.type+" error: "+lessEx.message+"\n"+(lessEx.extract&&lessEx.extract.join&&lessEx.extract.join("")),this.elements.cssCode.css("color","red").text(errorText),this},LessCompiler.prototype.parseLess=function(lessCode){var resultCss;return resultCss="",this.parser.parse(lessCode,function(lessEx,result){if(lessEx)throw lessEx;return resultCss=result.toCSS()}),resultCss},LessCompiler}(),jQuery(function($){var compiler,elements;return elements={lessVersion:$("#lessVersion"),loadingGif:$("#loadingGif"),lessInput:$("#lessInput"),cssCode:$("#cssOutput")},compiler=new LessCompiler(elements),compiler.setupEvents().loadLess()});