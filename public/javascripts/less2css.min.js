(function(){var EventEmitter,t,Stor,e=[].slice,s={}.hasOwnProperty,o=function(t,e){function o(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};EventEmitter=function(){function EventEmitter(){this._callbacks={}}return EventEmitter.prototype.on=function(t,e){var s;return((s=this._callbacks)[t]||(s[t]=[])).push(e),this},EventEmitter.prototype.once=function(t,e){var s,o=this;return s=function(){return o.off(t,s),e.apply(o,arguments)},e._off=s,this.on(t,s)},EventEmitter.prototype.off=function(t,e){var s,o;return(s=this._callbacks[t])?1===arguments.length?(delete this._callbacks[t],this):(o=s.indexOf(e._off||e),~o&&s.splice(o,1),this):this},EventEmitter.prototype.emit=function(){var t,s,o,n,r,i,a;if(n=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],o=this._callbacks[n])for(a=o.slice(0),r=0,i=a.length;i>r;r++)s=a[r],s.apply(this,t);return this},EventEmitter.prototype.listeners=function(t){return this._callbacks[t]||[]},EventEmitter.prototype.hasListeners=function(t){return!!this.listeners(t).length},EventEmitter}(),jQuery(function($){var OptionsDrawer;return OptionsDrawer=function(t){function OptionsDrawer(t){var e;OptionsDrawer.__super__.constructor.call(this),e={selectors:{optsDrawer:"#optionsDrawer",toggleBtns:".toggleBtn",toggleChks:".toggleChk",optsForm:"form#optionsDrawerWrap",optsBtn:"#optionsButton",optsLnk:"#optionsLink",nav:"#nav"},fx:{duration:500},text:{optsOpen:"Close",optsDefault:"Options"}},this.opts=$.extend(e,t),this.isOpen=!1,this.setupEls(),this.closeDrawer(!0),this.setupEvents(),this.updateModel()}return o(OptionsDrawer,t),OptionsDrawer.prototype.setupEls=function(){var t,e,s,o;t={},this.els={},o=this.opts.selectors;for(e in o)s=o[e],/^\.\w/i.test(s)?t[e]=s:this.els[e]=$(s);for(e in t)s=t[e],this.els[e]=this.els.optsDrawer.find(s);this.els.optsDrawer.find(".hide").hide().removeClass("hide")},OptionsDrawer.prototype.setupEvents=function(){var t,e;e=this,t=e.els,t.optsBtn.on("click",function(t){return t.preventDefault(),e.isOpen?e.closeDrawer.call(e):e.openDrawer.call(e,t)}),t.optsLnk.on("click",function(t){return t.preventDefault(),e.els.optsBtn.trigger("click")}),t.optsForm.on("change",function(t){return e.updateModel.call(e,t)}),t.optsForm.on("submit",function(t){return t.preventDefault()})},OptionsDrawer.prototype.updateModel=function(t){var e,s,o;return null==t&&(t={}),s=this.model||{},o=this.els.optsForm.serialize(),e=function(){var t,s,n,r,i;for(e={},s=o.split("&"),r=0,i=s.length;i>r;r++)t=s[r],n=t.split("="),e[n[0]]=n[1]||"";return e}(),this.emit("change",t,e,s),this.model=e},OptionsDrawer.prototype.openDrawer=function(){var t,e;e={top:this.els.nav.height(),opacity:1},t={duration:this.opts.fx.duration},this.detach(),this.animateDrawer("open",e,t)},OptionsDrawer.prototype.closeDrawer=function(t){var e,s,o;o=this,s={top:-this.getDrawerTop(),opacity:0},e={duration:t?0:this.opts.fx.duration},e.complete=t?function(){return o.els.optsDrawer.fadeIn()}:void 0,this.animateDrawer("close",s,e)},OptionsDrawer.prototype.animateDrawer=function(t,e,s){var o,n,r,i;i=this,r=this.els.optsDrawer,n=new $.Deferred,o=s.complete||function(){},s.complete=function(){return n.resolve(),o.apply(i,arguments)},r.animate(e,s),n.done(function(){return"close"===t?i.onClose.call(i):i.onOpen.call(i)})},OptionsDrawer.prototype.onOpen=function(){this.isOpen=!0},OptionsDrawer.prototype.onClose=function(){this.attach(),this.isOpen=!1},OptionsDrawer.prototype.getDrawerTop=function(){return this.els.optsDrawer.outerHeight()-this.els.nav.height()},OptionsDrawer.prototype.getBtnLeft=function(){var t;return t=this.els.optsBtn[0],t.parentElement.offsetLeft+t.parentElement.parentElement.offsetLeft},OptionsDrawer.prototype.attach=function(){this.els.optsBtn.insertAfter(this.els.optsLnk),this.els.optsBtn.removeClass("active")[0].style.cssText=""},OptionsDrawer.prototype.detach=function(){var t,e,s,o;t=this.els,s=t.optsBtn,o=s.width(),e=this.getBtnLeft(),t.optsBtn.css({left:e,width:o}).addClass("active"),this.els.optsBtn.appendTo(this.els.optsForm)},OptionsDrawer}(EventEmitter),$.fn.OptionsDrawer=OptionsDrawer}),Stor=function(){function Stor(t,e){this.key=null!=t?t:void 0,this.exp=null!=e?e:null,this.amp=amplify.store}return Stor.prototype.get=function(t){return null==t&&(t=this.key),this.amp(t)},Stor.prototype.set=function(t,e,s){return null==e&&(e=this.key),null==s&&(s=this.exp),this.amp(e,t,s)},Stor.prototype.remove=function(t){return null==t&&(t=this.key),this.amp(t,null)},Stor.prototype.empty=function(){var t,e;return t=this,e=t.amp(),$.each(e,function(e,s){t.amp(s,null)})},Stor}(),t=function(){function t(t,e){var s;t&&(this.elements=t,this.editor=CodeMirror.fromTextArea(t.lessInput[0],{theme:"lesser-dark",lineNumbers:!0,matchBrackets:!0,tabSize:2}),s={cdnFallback:"js/less/less-{version}.js",useFallback:!1,saveLess:!0,lessCDN:"//raw.github.com/cloudhead/less.js/master/dist/less-{version}.js",lessOptions:{dumpLineNumbers:!1,relativeUrls:!1,rootpath:!1,filename:"less2css.org.less"}},this.defaults=_.cloneDeep(s),this.options=$.extend(s,e),this.storage=new Stor("lessCode"),this.setupDrawer())}return t.prototype.updateOptions=function(t){var e,s,o;e=this.options.lessOptions;for(s in e)o=e[s],e[s]=t.hasOwnProperty(s)?t[s]:this.defaults.lessOptions[s]},t.prototype.setupDrawer=function(){var t,e,s;return s=this,t=new $.fn.OptionsDrawer,e=t.els,e.toggleBtns.on("click",function(t){var o,n,r;t.stopImmediatePropagation(),r=e.toggleBtns.index(this),n=e.toggleChks.eq(r),o=$(this),n.is(":checked")?s.drawerBtnToggleOff(o,n):s.drawerBtnToggleOn(o,n)}),this.drawer=t,this},t.prototype.drawerBtnToggleOn=function(t,e){var s;e.prop("checked",!0),t.addClass("btn-primary").text("Enabled"),s=t.siblings(":disabled"),s.length?s.addClass("enabled").fadeIn().prop("disabled",!1).trigger("change"):e.trigger("change")},t.prototype.drawerBtnToggleOff=function(t,e){var s;e.prop("checked",!1),t.removeClass("btn-primary").text("Disabled"),s=t.siblings(".enabled"),s.length?s.fadeOut().prop("disabled",!0).trigger("change"):e.trigger("change")},t.prototype.setupEvents=function(){var t,e,s,o,n;return o=this,s=this.elements,e=this.editor,t=this.storage.get(),n=s.lessVersion.find("option"),t?(e.setValue(t),this.previousLessCode=t):this.previousLessCode=e.getValue(),this.drawer.on("change",function(t,e){var s,n,r;return s=$(t.target),n=s.attr("name"),"lessVersion"===n?(r=s.find("option").filter(":selected").is("[data-prerelease=true]")?!0:!1,o.loadLess(r)):(o.updateOptions(e),o.loadComplete.call(o)),console.log(e)}),e.on("change",function(){var t;t=o.editor.getValue(),o.previousLessCode!==t&&(o.previousLessCode=t,o.compileLess())}),this},t.prototype.loadLess=function(t){var e,s,o,n,r,i,a;return i=this,o=this.options,e=this.elements,n=o.useFallback?o.cdnFallback:o.lessCDN,e.loadingGif.fadeIn(),this.editor.options.readOnly=!0,a=e.lessVersion.val(),a=t?""+a+"-alpha":a,r=n.replace("{version}",a),window.less=void 0,s=$.ajax({dataType:"script",cache:!0,url:r}),s.then(function(){window.less?i.loadComplete.call(i):(i.tryCount=i.tryCount?i.tryCount++:1,i.options.useFallback=!0,3>=i.tryCount&&i.loadLess())}),this},t.prototype.loadComplete=function(){return this.parser=new less.Parser(this.options.lessOptions),this.editor.options.readOnly=!1,this.compileLess(),this.elements.loadingGif.fadeOut(),this},t.prototype.compileLess=function(){var t,e;e=this.editor.getValue(),this.options.saveLess&&this.storage.set(e);try{t=this.parseLess(e),this.updateCSS(t)}catch(s){this.updateError(s)}return this},t.prototype.updateCSS=function(t){var e;return e=hljs.highlight("css",t).value,this.elements.cssCode.css("color","").html(e),this},t.prototype.updateError=function(t){var e;return e=""+t.type+" error: "+t.message+"\n"+(t.extract&&t.extract.join&&t.extract.join("")),this.elements.cssCode.css("color","red").text(e),this},t.prototype.parseLess=function(t){var e;return e="",this.parser.parse(t,function(t,s){if(t)throw t;return e=s.toCSS()}),e},t}(),jQuery(function($){var e,s;return s={lessVersion:$("#lessVersion"),loadingGif:$("#loadingGif"),lessInput:$("#lessInput"),cssCode:$("#cssOutput")},e=window.comp=new t(s),e.setupEvents().loadLess()})}).call(this);